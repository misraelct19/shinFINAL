<!-- index.html -->
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SHIN - Academia Aikido MazatlÃ¡n</title>
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2&display=swap" rel="stylesheet">
  <style>
    .hidden { display: none; }
    .jugador.card {
      background: #fdfdfd;
      border: 1px solid #ddd;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .perfil-link {
      text-decoration: none;
      color: inherit;
    }
    .avatar {
      font-size: 2rem;
      margin-right: 10px;
    }
  </style>
</head>
<body>
  <div class="inicio">
    <img src="logotipo aikido.jpg" alt="Logotipo Aikido" class="logo">
    <h1>åˆæ°—é“ ãƒã‚µãƒˆãƒ©ãƒ³</h1>
    <h2>Tabla de puntuaciones - Grupos Infantiles de Aikido MazatlÃ¡n</h2>
    <h3>Sistema HolÃ­stico de InstrucciÃ³n para NiÃ±os</h3>
    <input type="password" id="clave" placeholder="Ingresa la clave" />
    <button onclick="validarClave()">Entrar</button>
    <p id="error" class="error"></p>
  </div>

  <div class="leaderboard hidden" id="leaderboard">
    <h2>Tabla de Estudiantes</h2>
    <button onclick="window.location.href='nombramientos.html'" class="btn-nombramientos">ğŸ‘‘ Ver Nombramientos del Mes</button>
    <div id="jugadores"></div>
  </div>

  <script>
    const CLAVE = "dojo2025";
    const alumnos = [
      { nombre: "Camila Patricia ChÃ¡vez Bonilla", grado: "5to KYU", avatar: "ğŸ¦Š" },
      { nombre: "Oliver Aguirre Recio", grado: "8vo KYU", avatar: "ğŸ¯" },
      { nombre: "Maximiliano Diaz de LeÃ³n Diaz", grado: "6to KYU", avatar: "ğŸ¸" },
      { nombre: "Luis Fernando Partida Rivas", grado: "5to KYU", avatar: "ğŸ¼" },
      { nombre: "Thiago Galindo LÃ³pez", grado: "7mo KYU", avatar: "ğŸ¨" },
      { nombre: "ZÃ­a RodrÃ­guez Recio", grado: "8vo KYU", avatar: "ğŸ¦" },
      { nombre: "Ian FabiÃ¡n Valdez CÃ¡rdenas", grado: "7mo KYU", avatar: "ğŸ¦„" },
      { nombre: "Erick Salazar HernÃ¡ndez", grado: "7mo KYU", avatar: "ğŸ»" },
      { nombre: "Isaac Salazar HernÃ¡ndez", grado: "7mo KYU", avatar: "ğŸ§" },
      { nombre: "Valentina ChÃ¡vez Castro", grado: "6to KYU", avatar: "ğŸ¦•" },
      { nombre: "MarÃ­a JosÃ© Heredia Oceguera", grado: "7mo KYU", avatar: "ğŸ¦‰" },
      { nombre: "Monserrat Meza De La Torre", grado: "7mo KYU", avatar: "ğŸ°" },
      { nombre: "Mariano Altamirano Escobar", grado: "8vo KYU", avatar: "ğŸ¦‹" },
      { nombre: "Ariana Celeste RamÃ­rez RodrÃ­guez", grado: "7mo KYU", avatar: "ğŸµ" },
      { nombre: "Kiara Lilith Ayala Soto", grado: "7mo KYU", avatar: "ğŸ™" },
      { nombre: "Diego Fierro Elenes", grado: "7mo KYU", avatar: "ğŸ¦–" },
      { nombre: "Victoria Gpe. Morales CÃ¡rdenas", grado: "7mo KYU", avatar: "ğŸ®" },
      { nombre: "Ximena Fierro Elenes", grado: "7mo KYU", avatar: "ğŸº" },
      { nombre: "RaÃºl Alexander Aguirre SolÃ­s", grado: "", avatar: "ğŸ¦•" },
      { nombre: "JosÃ© Luis Rangel RuÃ­z", grado: "", avatar: "ğŸ”" },
      { nombre: "Jason Alonzo Rangel RuÃ­z", grado: "", avatar: "ğŸ¢" },
      { nombre: "Bernardo Vargas Zetina", grado: "5to KYU", avatar: "ğŸ" },
      { nombre: "SofÃ­a Isabella Sarabia De Los Santos", grado: "5to KYU", avatar: "ğŸ™" }
    ];

    function validarClave() {
      const input = document.getElementById("clave").value;
      if (input === CLAVE) {
        document.querySelector(".inicio").classList.add("hidden");
        document.getElementById("leaderboard").classList.remove("hidden");
        cargarPuntosDesdePerfiles();
      } else {
        document.getElementById("error").textContent = "Clave incorrecta";
      }
    }

    function cargarPuntosDesdePerfiles() {
      const jugadoresConPuntos = [];
      let pendientes = alumnos.length;

      alumnos.forEach(alumno => {
        const url = `perfil.html?nombre=${encodeURIComponent(alumno.nombre)}`;
        fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, "text/html");
            const puntosText = doc.getElementById("puntos")?.textContent || "0";
            const puntos = parseInt(puntosText);
            jugadoresConPuntos.push({ ...alumno, puntos });
          })
          .catch(() => {
            jugadoresConPuntos.push({ ...alumno, puntos: 0 });
          })
          .finally(() => {
            pendientes--;
            if (pendientes === 0) {
                mostrarLeaderboard();
};
            }
          });
      });
    }

    function mostrarLeaderboard() {
  const contenedor = document.getElementById("alumnos");
  contenedor.innerHTML = "";

  // Cargar puntos reales desde localStorage
  alumnos.forEach(j => {
    const datos = localStorage.getItem('aikipoints_' + j.nombre);
    if (datos) {
      const obj = JSON.parse(datos);
      j.puntos = obj.puntos;
    }
  });

  // Ordenar por puntos
  alumnos.sort((a, b) => b.puntos - a.puntos);

  // Mostrar tarjetas
  alumnos.forEach((j) => {
    const div = document.createElement("div");
    div.className = "alumno card";
    div.innerHTML = `
      <a href="perfil.html?nombre=${encodeURIComponent(j.nombre)}" class="perfil-link">
        <div>
          <span class='avatar'>${j.avatar}</span>
          <strong>${j.nombre}</strong><br>
          <small>Grado: ${j.grado || 'Sin especificar'}</small><br>
          <span>${j.puntos} pts</span>
        </div>
      </a>
    `;
    contenedor.appendChild(div);
  });
}
